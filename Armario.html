<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Armario David</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Press Start 2P', cursive;
      background: url('fondo.jpg') no-repeat center center fixed;
      background-size: cover;
      cursor: url('cursor.png') 0 0, auto;
      user-select: none;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 20px 10px 10px;
      font-size: 1.8rem;
      color: #541214;
      text-shadow: 2px 2px 0 #fceabb;
      flex-shrink: 0;
    }
    #main-container {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      max-width: 1200px;
      margin: 0 auto;
      gap: 15px;
      padding: 10px;
      overflow: hidden;
    }
    .side-column {
      width: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      overflow-y: auto;
      max-height: 650px;
      padding: 5px 0;
      border-radius: 10px;
      background: #f9e7ee;
      box-shadow: inset 0 0 10px #dda9c4;
    }
    .side-column .category-label {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: 0.8rem;
      font-weight: bold;
      color: #541214;
      margin-bottom: 20px;
      user-select: none;
    }
    .side-column .scroll-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      width: 100%;
      max-height: 580px;
      scrollbar-width: thin;
    }
    .side-column .scroll-container::-webkit-scrollbar { width: 6px; }
    .side-column .scroll-container::-webkit-scrollbar-thumb {
      background-color: #aa7a00;
      border-radius: 3px;
    }
    #center-content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 25px;
    }
    .category-block {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }
    .category-label {
      font-size: 0.9rem;
      font-weight: bold;
      color: #541214;
      margin: 0 0 5px 0;
      user-select: none;
    }
    .scroll-container {
      display: flex;
      overflow-x: auto;
      width: 700px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .scroll-container::-webkit-scrollbar { display: none; }
    img.category-image {
      flex: 0 0 auto;
      width: 140px;
      height: 240px;
      object-fit: contain;
      scroll-snap-align: center;
      margin: 0 5px;
      opacity: 0.15;
      transition: opacity 0.3s ease;
      user-select: none;
      pointer-events: none;
    }
    img.category-image.active { opacity: 1; }
    .side-column img.category-image {
      width: 80px;
      height: 140px;
      margin: 8px auto;
      opacity: 0.15;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    .side-column img.category-image.active { opacity: 1 !important; }
    footer {
      padding: 12px 0;
      text-align: center;
      background: #fceabb;
      border-top: 3px solid #541214;
      box-shadow: 0 -3px 0 #aa7a00 inset;
      flex-shrink: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    #btnRandom {
      width: 220px;
      font-size: 0.9rem;
      font-family: 'Press Start 2P', cursive;
      padding: 10px;
      background: #fceabb;
      border: 3px solid #541214;
      box-shadow: 3px 3px 0 #aa7a00;
      border-radius: 4px;
      cursor: pointer;
      color: #541214;
      user-select: none;
    }
    #btnRandom:hover { background: #ffe7a1; }
    .btnFilters {
      width: 30px;
      height: 30px;
      font-size: 0.8rem;
      font-family: 'Press Start 2P', cursive;
      background: #fceabb;
      border: 2px solid #541214;
      box-shadow: 2px 2px 0 #aa7a00;
      border-radius: 50%;
      cursor: pointer;
      color: #541214;
      user-select: none;
    }
    .btnFilters:hover { background: #ffe7a1; }
    .filterMenu {
      display:none;
      position:absolute;
      background:#fceabb;
      border:2px solid #541214;
      border-radius:6px;
      box-shadow:3px 3px 0 #aa7a00;
      padding:10px;
      font-size:0.8rem;
      z-index:100;
    }
  </style>
</head>
<body>

<header>Armario David</header>

<div id="main-container">
  <div class="side-column" id="sideAccesorios">
    <div class="category-label">Accesorios</div>
    <div class="scroll-container" id="scrollAccesorio"></div>
  </div>
  <div id="center-content">
    <div class="category-block">
      <button class="btnFilters" data-cat="head">â–²</button>
      <div style="flex-grow:1;">
        <div class="category-label">Head</div>
        <div class="scroll-container" id="scrollHead"></div>
      </div>
      <div class="filterMenu" id="filterMenu-head">
        <label><input type="checkbox" class="filter" value="verano" checked> Verano</label><br>
        <label><input type="checkbox" class="filter" value="invierno" checked> Invierno</label><br>
        <label><input type="checkbox" class="filter" value="arreglado" checked> Arreglado</label><br>
        <label><input type="checkbox" class="filter" value="casual" checked> Casual</label><br>
      </div>
    </div>

    <div class="category-block">
      <button class="btnFilters" data-cat="arriba">â–²</button>
      <div style="flex-grow:1;">
        <div class="category-label">Partes de arriba</div>
        <div class="scroll-container" id="scrollArriba"></div>
      </div>
      <div class="filterMenu" id="filterMenu-arriba">
        <label><input type="checkbox" class="filter" value="verano" checked> Verano</label><br>
        <label><input type="checkbox" class="filter" value="invierno" checked> Invierno</label><br>
        <label><input type="checkbox" class="filter" value="arreglado" checked> Arreglado</label><br>
        <label><input type="checkbox" class="filter" value="casual" checked> Casual</label><br>
        <label><input type="checkbox" class="filter" value="friki" checked> Friki</label>
      </div>
    </div>

    <div class="category-block">
      <button class="btnFilters" data-cat="superior">â–²</button>
      <div style="flex-grow:1;">
        <div class="category-label">Superior</div>
        <div class="scroll-container" id="scrollSuperior"></div>
      </div>
      <div class="filterMenu" id="filterMenu-superior">
        <label><input type="checkbox" class="filter" value="verano" checked> Verano</label><br>
        <label><input type="checkbox" class="filter" value="invierno" checked> Invierno</label><br>
        <label><input type="checkbox" class="filter" value="arreglado" checked> Arreglado</label><br>
        <label><input type="checkbox" class="filter" value="casual" checked> Casual</label><br>
        <label><input type="checkbox" class="filter" value="friki" checked> Friki</label>
      </div>
    </div>

    <div class="category-block">
      <button class="btnFilters" data-cat="abajo">â–²</button>
      <div style="flex-grow:1;">
        <div class="category-label">Partes de abajo</div>
        <div class="scroll-container" id="scrollAbajo"></div>
      </div>
      <div class="filterMenu" id="filterMenu-abajo">
        <label><input type="checkbox" class="filter" value="verano" checked> Verano</label><br>
        <label><input type="checkbox" class="filter" value="invierno" checked> Invierno</label><br>
        <label><input type="checkbox" class="filter" value="arreglado" checked> Arreglado</label><br>
        <label><input type="checkbox" class="filter" value="casual" checked> Casual</label><br>
      </div>
    </div>

    <div class="category-block">
      <button class="btnFilters" data-cat="zapatos">â–²</button>
      <div style="flex-grow:1;">
        <div class="category-label">Zapatos</div>
        <div class="scroll-container" id="scrollZapatos"></div>
      </div>
      <div class="filterMenu" id="filterMenu-zapatos">
        <label><input type="checkbox" class="filter" value="verano" checked> Verano</label><br>
        <label><input type="checkbox" class="filter" value="invierno" checked> Invierno</label><br>
        <label><input type="checkbox" class="filter" value="arreglado" checked> Arreglado</label><br>
        <label><input type="checkbox" class="filter" value="casual" checked> Casual</label><br>
      </div>
    </div>
  </div>
</div>

<footer>
  <button id="btnRandom">LET'S PLAY ðŸŽ²</button>
</footer>

<script>
const categories = [
  {name: 'head', containerId: 'scrollHead', images: [], vertical: false},
  {name: 'arriba', containerId: 'scrollArriba', images: [], vertical: false},
  {name: 'superior', containerId: 'scrollSuperior', images: [], vertical: false},
  {name: 'abajo', containerId: 'scrollAbajo', images: [], vertical: false},
  {name: 'zapatos', containerId: 'scrollZapatos', images: [], vertical: false},
  {name: 'accesorio', containerId: 'scrollAccesorio', images: [], vertical: true},
];

async function loadPrendas() {
  const response = await fetch("prendas.json");
  const prendas = await response.json();
  categories.forEach(cat => {
    cat.images = prendas.filter(p => p.categoria === cat.name);
  });
}

function buildCarousel(category) {
  const container = document.getElementById(category.containerId);
  container.innerHTML = '';
  if(category.images.length === 0) {
    container.innerHTML = '<small style="color:#541214;">No hay imÃ¡genes</small>';
    return;
  }
  for(let repeat=0; repeat < 3; repeat++) {
    category.images.forEach(item => {
      const img = document.createElement('img');
      img.src = item.url;
      img.alt = `${item.categoria} - ${item.colores?.join(', ')} - ${item.estilos?.join(', ')}`;
      img.classList.add('category-image');
      container.appendChild(img);
    });
  }
}

function initScrollPosition(container, vertical=false) {
  if(vertical) {
    container.scrollTop = container.scrollHeight / 3;
  } else {
    container.scrollLeft = container.scrollWidth / 3;
  }
}

function updateActiveImage(container) {
  const imgs = container.querySelectorAll('img.category-image');
  const containerRect = container.getBoundingClientRect();
  const centerX = containerRect.left + containerRect.width / 2;
  let closestImg = null, closestDist = Infinity;
  imgs.forEach(img => {
    const rect = img.getBoundingClientRect();
    const imgCenterX = rect.left + rect.width / 2;
    const dist = Math.abs(centerX - imgCenterX);
    if(dist < closestDist) {
      closestDist = dist;
      closestImg = img;
    }
    img.style.opacity = '0.15';
  });
  if (closestImg) closestImg.style.opacity = '1';
}

function updateActiveImageVertical(container) {
  const imgs = container.querySelectorAll('img.category-image');
  const containerRect = container.getBoundingClientRect();
  const centerY = containerRect.top + containerRect.height / 2;
  let closestImg = null, closestDist = Infinity;
  imgs.forEach(img => {
    const rect = img.getBoundingClientRect();
    const imgCenterY = rect.top + rect.height / 2;
    const dist = Math.abs(centerY - imgCenterY);
    if(dist < closestDist) {
      closestDist = dist;
      closestImg = img;
    }
    img.style.opacity = '0.15';
  });
  if (closestImg) closestImg.style.opacity = '1';
}

function handleInfiniteScroll(container, vertical=false) {
  if(vertical) {
    if(container.scrollTop <= 0) {
      container.scrollTop = container.scrollHeight / 3;
    } else if(container.scrollTop >= container.scrollHeight * 2/3) {
      container.scrollTop = container.scrollHeight / 3;
    }
  } else {
    if(container.scrollLeft <= 0) {
      container.scrollLeft = container.scrollWidth / 3;
    } else if(container.scrollLeft >= container.scrollWidth * 2/3) {
      container.scrollLeft = container.scrollWidth / 3;
    }
  }
}

function getCategoryFilters(catName) {
  const menu = document.getElementById(`filterMenu-${catName}`);
  if (!menu) return [];
  const checks = menu.querySelectorAll(".filter:checked");
  return Array.from(checks).map(c => c.value);
}

document.querySelectorAll(".btnFilters").forEach(btn => {
  btn.addEventListener("click", () => {
    const cat = btn.dataset.cat;
    const menu = document.getElementById(`filterMenu-${cat}`);
    if (menu.style.display === "block") {
      menu.style.display = "none";
    } else {
      document.querySelectorAll(".filterMenu").forEach(m => m.style.display="none");
      menu.style.display = "block";
    }
  });
});

document.getElementById('btnRandom').addEventListener('click', () => {
  categories.forEach(cat => {
    const container = document.getElementById(cat.containerId);
    if(cat.images.length === 0) return;
    let validImgs;
    const activeFilters = getCategoryFilters(cat.name);
    if (cat.name === "accesorio") {
      validImgs = cat.images;
    } else if (cat.name === "arriba" || cat.name === "superior") {
      validImgs = cat.images.filter(item => {
        if (item.estilos?.some(est => activeFilters.includes(est))) return true;
        if (activeFilters.includes("friki") && item.friki) return true;
        return false;
      });
    } else {
      validImgs = cat.images.filter(item => {
        return item.estilos?.some(est => activeFilters.includes(est));
      });
    }
    if(validImgs.length === 0) validImgs = cat.images;
    const chosen = validImgs[Math.floor(Math.random() * validImgs.length)];
    const imgs = container.querySelectorAll("img.category-image");
    const match = Array.from(imgs).find(img => img.src.includes(chosen.url));
    if (!match) return;
    const containerRect = container.getBoundingClientRect();
    if(cat.vertical) {
      const offset = (match.offsetTop + match.height/2) - containerRect.height/2;
      container.scrollTo({top: offset, behavior: "smooth"});
    } else {
      const offset = (match.offsetLeft + match.width/2) - containerRect.width/2;
      container.scrollTo({left: offset, behavior: "smooth"});
    }
  });
});

async function init() {
  await loadPrendas();
  document.querySelectorAll(".filter").forEach(cb => cb.checked = true);
  for(const cat of categories) {
    buildCarousel(cat);
    const container = document.getElementById(cat.containerId);
    initScrollPosition(container, cat.vertical);
    if(cat.vertical) {
      updateActiveImageVertical(container);
      container.addEventListener('scroll', () => {
        handleInfiniteScroll(container, true);
        updateActiveImageVertical(container);
      });
    } else {
      updateActiveImage(container);
      container.addEventListener('scroll', () => {
        handleInfiniteScroll(container, false);
        updateActiveImage(container);
      });
    }
  }
}
init();

// Hacer scroll con arrastre de ratÃ³n solo en carruseles horizontales
document.querySelectorAll('.scroll-container').forEach(container => {
  if (container.scrollHeight > container.clientHeight) return; // saltar verticales

  let isDown = false;
  let startX;
  let scrollLeft;

  container.addEventListener('mousedown', (e) => {
    isDown = true;
    container.classList.add('active');
    startX = e.pageX - container.getBoundingClientRect().left;
    scrollLeft = container.scrollLeft;
  });
  container.addEventListener('mouseleave', () => {
    isDown = false;
    container.classList.remove('active');
  });
  container.addEventListener('mouseup', () => {
    isDown = false;
    container.classList.remove('active');
  });
  container.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - container.getBoundingClientRect().left;
    const walk = (x - startX) * 1.5; // velocidad de arrastre
    container.scrollLeft = scrollLeft - walk;
  });
});

</script>

</body>
</html>

